{
  "settings": {
    "analysis": {
      "char_filter": {
        "digits_only": {
          "type": "pattern_replace",
          "pattern": "[^\\d]"
        }
      },
      "filter": {
        "us_phone_number": {
          "type": "pattern_capture",
          "preserve_original": true,
          "patterns": [
            "1?(1)(\\d*)"
          ]
        },
        "ten_digits_min": {
          "type": "length",
          "min": 10
        },
        "not_empty": {
          "type": "length",
          "min": 1
        }
      },
      "analyzer": {
        "phone_number": {
          "char_filter": "digits_only",
          "tokenizer": "keyword",
          "filter": [
            "us_phone_number",
            "ten_digits_min"
          ]
        },
        "phone_number_search" : {
          "char_filter" : "digits_only",
          "tokenizer" : "keyword",
          "filter" : [
            "not_empty"
          ]
        }
      }
    }
  },
  "mappings": {
    "_doc": {
      "properties": {
        "id": {
          "type": "keyword"
        },
        "name": {
          "type": "text",
          "fields": {
            "english": {
              "type": "text",
              "analyzer": "english"
            }
          }
        },
        "description": {
          "type": "text",
          "fields": {
            "english": {
              "type": "text",
              "analyzer": "english"
            }
          }
        },
        "image": {
          "enabled": false
        },
        "author": {
          "type": "keyword"
        },
        "authorUser": {
          "properties": {
            "displayName": {
              "type": "text"
            },
            "photoURL": {
              "type": "keyword",
              "index": false
            }
          }
        },
        "users": {
          "type": "keyword"
        },
        "modelVersion": {
          "type": "short"
        },
        "createTimestamp": {
          "type": "date"
        },
        "updateTimestamp": {
          "type": "date"
        },
        "publishTimestamp": {
          "type": "date"
        },
        "publishVersion": {
          "type": "integer"
        },
        "_all_nested": {
          "type": "text",
          "analyzer": "english"          
        },
        "contacts": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "givenName": {
              "type": "text",
              "copy_to": "_all_nested"
            },
            "familyName": {
              "type": "text",
              "copy_to": "_all_nested"
            },
            "organizationName": {
              "type": "text",
              "copy_to": "_all_nested"
            },
            "imageData": {
              "type": "keyword",
              "index": false
            },
            "birthday": {
              "type": "date",
              "format": "yyyy-MM-dd"
            },
            "phoneNumbers": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "value": {
                  "type": "text",
                  "analyzer": "phone_number",
                  "search_analyzer": "phone_number_search",
                  "copy_to": "_all_nested"
                }
              }
            },
            "emailAddresses": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "value": {
                  "type": "keyword",
                  "copy_to": "_all_nested"
                }
              }
            },
            "postalAddresses": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "street": {
                  "type": "text",
                  "copy_to": "_all_nested"
                },
                "city": {
                  "type": "text",
                  "copy_to": "_all_nested"
                }, 
                "state": {
                  "type": "keyword",
                  "copy_to": "_all_nested"
                },
                "postalCode": {
                  "type": "text",
                  "copy_to": "_all_nested"
                },
                "country": {
                  "type": "text",
                  "copy_to": "_all_nested"
                }
              }
            },
            "urlAddresses": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "value": {
                  "type": "keyword"
                }
              }
            },
            "socialProfiles": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "username": {
                  "type": "keyword",
                  "copy_to": "_all_nested"
                }
              }
            },
            "instantMessageAddresses": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "username": {
                  "type": "keyword",
                  "copy_to": "_all_nested"
                }
              }
            },
            "dates": {
              "type": "nested",
              "properties": {
                "label": {
                  "type": "keyword"
                },
                "value": {
                  "type": "date",
                  "format": "yyyy-MM-dd"
                }
              }
            }
          }
        },
        "events": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "adjustStartDate": {
              "type": "boolean",
              "index": false
            },
            "alert1RelativeOffset": {
              "type": "long",
              "index": false
            },
            "alert2RelativeOffset": {
              "type": "long",
              "index": false
            },
            "daysOfTheMonth": {
              "type": "byte",
              "index": false
            },
            "daysOfTheWeek": {
              "type": "byte",
              "index": false
            },
            "daysOfTheYear": {
              "type": "short",
              "index": false
            },
            "monthsOfTheYear": {
              "type": "byte",
              "index": false
            },
            "weeksOfTheYear": {
              "type": "byte",
              "index": false
            },
            "setPositions": {
              "type": "short",
              "index": false
            },
            "endDate": {
              "type": "date"
            },
            "interval": {
              "type": "integer",
              "index": false
            },
            "isAllDay": {
              "type": "boolean",
              "index": false
            },
            "itemDescription": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "location": {
              "type": "text",
              "copy_to": "_all_nested"
            },
            "notes": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "occurenceCount": {
              "type": "long",
              "index": false
            },
            "recurrenceEndDate": {
              "type": "date",
              "index": false
            },
            "recurrenceType": {
              "type": "keyword"
            },
            "startDate": {
              "type": "date"
            },
            "title": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "travelTime": {
              "type": "long",
              "index": false
            },
            "url": {
              "type": "keyword",
              "index": false
            }
          }
        },
        "images": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "image": {
              "enabled": false
            },
            "name": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            }
          }
        },
        "links": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "url": {
              "type": "keyword",
              "index": false
            },
            "preview": {
              "properties": {
                "description": {
                  "type": "text",
                  "copy_to": "_all_nested",
                  "fields": {
                    "english": {
                      "type": "text",
                      "analyzer": "english"
                    }
                  }
                },
                "image": {
                  "type": "keyword",
                  "index": false
                },
                "logo": {
                  "type": "keyword",
                  "index": false
                },
                "publisher": {
                  "type": "text"
                },
                "url": {
                  "type": "keyword",
                  "index": false
                },
                "requestUrl": {
                  "type": "keyword",
                  "index": false
                },
                "title": {
                  "type": "text",
                  "copy_to": "_all_nested",
                  "fields": {
                    "english": {
                      "type": "text",
                      "analyzer": "english"
                    }
                  }
                }
              }
            }
          }
        },
        "notes": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "note": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "title": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            }
          }
        },
        "reminders": {
          "type": "nested",
          "properties": {
            "id": {
              "type": "keyword"
            },
            "adjustStartDate": {
              "type": "boolean",
              "index": false
            },
            "alertDate": {
              "type": "date"
            },
            "daysOfTheMonth": {
              "type": "byte",
              "index": false
            },
            "daysOfTheWeek": {
              "type": "byte",
              "index": false
            },
            "daysOfTheYear": {
              "type": "short",
              "index": false
            },
            "monthsOfTheYear": {
              "type": "byte",
              "index": false
            },
            "weeksOfTheYear": {
              "type": "byte",
              "index": false
            },
            "setPositions": {
              "type": "short",
              "index": false
            },
            "itemDescription": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "notes": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "occurenceCount": {
              "type": "long",
              "index": false
            },
            "recurrenceEndDate": {
              "type": "date",
              "index": false
            },
            "recurrenceType": {
              "type": "keyword"
            },
            "title": {
              "type": "text",
              "copy_to": "_all_nested",
              "fields": {
                "english": {
                  "type": "text",
                  "analyzer": "english"
                }
              }
            },
            "priority": {
              "type": "byte"
            }
          }
        }
      }
    }
  }
}